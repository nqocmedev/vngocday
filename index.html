<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Gift Christmas - Nh·∫≠n Qu√† Gi√°ng Sinh ƒê·∫∑c Bi·ªát</title>
    <!-- Routing: N·∫øu kh√¥ng c√≥ ID trong URL, redirect sang create.html -->
    <script>
        // Ch·∫°y ngay l·∫≠p t·ª©c, kh√¥ng ƒë·ª£i DOM
        (function() {
            try {
                // L·∫•y ID t·ª´ URL hash (#id=xxx) ho·∫∑c query string (?id=xxx)
                function getGiftIdFromUrl() {
                    // Ki·ªÉm tra hash tr∆∞·ªõc (#id=xxx)
                    const hash = window.location.hash;
                    if (hash && hash.startsWith('#id=')) {
                        const id = hash.substring(4).trim();
                        if (id && id !== '') {
                            return id;
                        }
                    }
                    // Ki·ªÉm tra query string (?id=xxx)
                    const params = new URLSearchParams(window.location.search);
                    const idFromQuery = params.get('id');
                    if (idFromQuery && idFromQuery.trim() !== '') {
                        return idFromQuery.trim();
                    }
                    return null;
                }
                
                // N·∫øu kh√¥ng c√≥ ID, redirect sang create.html
                const giftId = getGiftIdFromUrl();
                if (!giftId) {
                    // T√≠nh to√°n ƒë∆∞·ªùng d·∫´n create.html
                    const currentPath = window.location.pathname;
                    let createPath;
                    
                    if (currentPath === '/' || currentPath === '/index.html' || currentPath.endsWith('/index.html')) {
                        // ·ªû root, d√πng ƒë∆∞·ªùng d·∫´n t∆∞∆°ng ƒë·ªëi
                        createPath = 'create/create.html';
                    } else {
                        // ·ªû th∆∞ m·ª•c kh√°c, d√πng ƒë∆∞·ªùng d·∫´n t∆∞∆°ng ƒë·ªëi
                        createPath = './create/create.html';
                    }
                    
                    // D√πng replace ƒë·ªÉ tr√°nh back button v√† ƒë·∫£m b·∫£o redirect ngay
                    window.location.replace(createPath);
                    // D·ª´ng execution ngay l·∫≠p t·ª©c
                    throw new Error('Redirecting...');
                }
            } catch (e) {
                // N·∫øu l√† redirect, kh√¥ng log error
                if (e.message !== 'Redirecting...') {
                    console.error('Routing error:', e);
                }
            }
        })();
    </script>
    <link rel="icon" type="image/png" href="assets/images/logo.png">
    <meta name="description" content="Nh·∫≠n qu√† Gi√°ng sinh ƒë·∫∑c bi·ªát v·ªõi l·ªùi ch√∫c ·∫•m √°p t·ª´ ng∆∞·ªùi th√¢n y√™u. Tr·∫£i nghi·ªám tuy·ªát v·ªùi v·ªõi animation ƒë·∫πp m·∫Øt v√† nh·∫°c n·ªÅn l√£ng m·∫°n.">
    <meta name="keywords" content="qu√† gi√°ng sinh, christmas gift, l·ªùi ch√∫c gi√°ng sinh, merry christmas, qu√† t·∫∑ng online">
    <meta name="author" content="Gift Christmas">
    
    <!-- Open Graph - Facebook & Zalo -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://giftchristmas.onrender.com/">
    <meta property="og:title" content="Gift Christmas - Nh·∫≠n Qu√† Gi√°ng Sinh ƒê·∫∑c Bi·ªát">
    <meta property="og:description" content="Nh·∫≠n qu√† Gi√°ng sinh ƒë·∫∑c bi·ªát v·ªõi l·ªùi ch√∫c ·∫•m √°p t·ª´ ng∆∞·ªùi th√¢n y√™u. Tr·∫£i nghi·ªám tuy·ªát v·ªùi v·ªõi animation ƒë·∫πp m·∫Øt v√† nh·∫°c n·ªÅn l√£ng m·∫°n.">
    <meta property="og:image" content="https://giftchristmas.onrender.com/assets/images/background1.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="vi_VN">
    <meta property="og:site_name" content="Gift Christmas">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://giftchristmas.onrender.com/">
    
    <link rel="preload" as="image" href="assets/images/background1.jpg">
    <link rel="stylesheet" href="style.css">
     <!-- Ch·∫∑n DevTools -->
     <script src="./detect-devtools.js"></script>
     <script type='text/javascript'>
         // Bypass for developers
         const keyName = 'key';
         const keyValue = '9ac7ec230e0e4513578f309d6d3579ad';
 
         // Handle via config
         DisableDevtool({
             tkName: keyName,
             md5: keyValue,
             interval: '100',
         });
     </script>
</head>
<body>
    <!-- Start Overlay -->
    <div id="start-overlay" class="start-overlay">
        <div class="start-overlay-content">
            <img src="assets/images/santa_notify.png" alt="Santa" class="santa-notify-icon">
            <h1 class="start-title">üéÑ √îng gi√† Noel ƒëang ph√°t qu√† r·ªìi! üéÑ</h1>
            <p class="start-message">B·∫°n ƒë√£ s·∫µn s√†ng ƒë·ªÉ nh·∫≠n m√≥n qu√† ƒë·∫∑c bi·ªát ch∆∞a?</p>
            <button id="start-button" class="start-button">S·∫µn s√†ng</button>
        </div>
    </div>

    <!-- Orientation Lock Message (for mobile) -->
    <div id="orientation-lock" class="orientation-lock">
        <div class="orientation-message">
            <img src="assets/images/rotate.png" alt="Rotate" class="rotate-icon">
            <p>Vui l√≤ng b·∫≠t xoay ngang m√†n h√¨nh nh√© ng∆∞·ªùi ƒë·∫πp</p>
        </div>
    </div>


    <!-- Background Video -->
    <video id="backgroundVideo" class="background-video" muted playsinline preload="auto" style="display: none;" oncontextmenu="return false;" controlslist="nodownload nofullscreen noremoteplayback">
        <source src="assets/images/intro.mp4" type="video/mp4">
    </video>

    <!-- Main Canvas for Text Animation -->
    <canvas class="canvas" style="display: none;"></canvas>


    <!-- Music Control -->
    <div id="musicControl" class="music-control" title="Play Music" style="display: none;">‚ñ∂</div>
    <audio id="christmasAudio" loop>
        <!-- Source s·∫Ω ƒë∆∞·ª£c set ƒë·ªông t·ª´ giftData ho·∫∑c ƒë·ªÉ tr·ªëng -->
    </audio>

    <!-- Settings Script (define before index.js) -->
    <script>
        // Default settings - b·∫°n c√≥ th·ªÉ thay ƒë·ªïi c√°c gi√° tr·ªã n√†y
        const settings = {
            countdown: 10,
            sequence: "Ch√∫c m·ª´ng gi√°ng sinh!|üéâüéÇüéÅ|Merry Christmas!|#gift",
            sequenceColor: "#ffffff",
            recipientName: "b√© y√™u" // T√™n ng∆∞·ªùi nh·∫≠n qu√†
        };
        window.settings = settings;

    </script>

    <!-- Load GiftChristmas API helper -->
    <script type="module">
        import { getGiftIdFromUrl, getGiftChristmasById } from './api/gift-christmas.js';
        
        // L∆∞u functions v√†o window ƒë·ªÉ d√πng trong index.js
        window.getGiftIdFromUrl = getGiftIdFromUrl;
        window.getGiftChristmasById = getGiftChristmasById;
        
        // Fetch GiftChristmas data n·∫øu c√≥ ID trong URL
        async function initGiftChristmas() {
            const giftId = getGiftIdFromUrl();
            if (giftId) {
                try {
                    const giftData = await getGiftChristmasById(giftId);
                    
                    // L∆∞u v√†o window ƒë·ªÉ d√πng ·ªü c√°c trang kh√°c
                    window.giftChristmasData = giftData;
                    
                    // Setup nh·∫°c n·ªÅn n·∫øu c√≥
                    setupBackgroundMusic(giftData);
                } catch (error) {
                    console.error('‚ùå Error loading GiftChristmas:', error);
                    // V·∫´n ti·∫øp t·ª•c v·ªõi flow b√¨nh th∆∞·ªùng n·∫øu kh√¥ng load ƒë∆∞·ª£c
                }
            }
        }
        
        // Setup nh·∫°c n·ªÅn t·ª´ ƒë·∫ßu (ph√°t t·ª´ intro video)
        function setupBackgroundMusic(giftData) {
            if (!giftData.musicType || !giftData.musicFile) {
                return;
            }
            
            const christmasAudio = document.getElementById('christmasAudio');
            if (!christmasAudio) {
                console.warn('‚ö†Ô∏è Audio element not found');
                return;
            }
            
            let musicUrl = '';
            
            if (giftData.musicType === 'sample') {
                // Nh·∫°c m·∫´u t·ª´ assets/musics/
                musicUrl = `assets/musics/${giftData.musicFile}`;
            } else if (giftData.musicType === 'file') {
                // Nh·∫°c upload t·ª´ URL
                musicUrl = giftData.musicFile;
            }
            
            if (musicUrl) {
                // Thay ƒë·ªïi source c·ªßa audio element
                christmasAudio.innerHTML = `<source src="${musicUrl}" type="audio/mpeg">`;
                christmasAudio.load();
                
                // KH√îNG t·ª± ƒë·ªông ph√°t nh·∫°c - ƒë·ª£i click "S·∫µn s√†ng"
                // Nh·∫°c s·∫Ω ƒë∆∞·ª£c ph√°t khi click button "S·∫µn s√†ng" trong readyOverlayBtn handler
                
                console.log('üéµ Background music setup:', musicUrl);
            }
        }
        
        // G·ªçi init khi DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGiftChristmas);
        } else {
            initGiftChristmas();
        }
    </script>

    <!-- Main JavaScript -->
    <script src="index.js"></script>
</body>
</html>

